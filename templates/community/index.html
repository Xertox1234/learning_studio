{% extends 'base/base.html' %}
{% load static %}

{% block title %}Community - Python Learning Studio{% endblock %}

{% block breadcrumb %}
<nav aria-label="breadcrumb" class="container-fluid py-2 bg-light">
    <ol class="breadcrumb mb-0">
        <li class="breadcrumb-item"><a href="{% url 'wagtail_serve' '' %}">Home</a></li>
        <li class="breadcrumb-item active">Community</li>
    </ol>
</nav>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Community Header -->
    <div class="row mb-4">
        <div class="col">
            <div class="text-center">
                <h1 class="h2 mb-3">Python Learning Community</h1>
                <p class="lead text-muted">Connect, learn, and grow together with fellow Python developers</p>
            </div>
        </div>
    </div>

    <!-- Community Stats -->
    <div class="row mb-5">
        <div class="col-md-3 text-center mb-3">
            <div class="community-stat">
                <div class="h2 text-primary">{{ total_users }}+</div>
                <div class="text-muted">Community Members</div>
            </div>
        </div>
        <div class="col-md-3 text-center mb-3">
            <div class="community-stat">
                <div class="h2 text-success">{{ total_topics }}+</div>
                <div class="text-muted">Discussions</div>
            </div>
        </div>
        <div class="col-md-3 text-center mb-3">
            <div class="community-stat">
                <div class="h2 text-info">{{ total_posts }}+</div>
                <div class="text-muted">Forum Posts</div>
            </div>
        </div>
        <div class="col-md-3 text-center mb-3">
            <div class="community-stat">
                <div class="h2 text-warning">{{ total_forums }}+</div>
                <div class="text-muted">Forum Categories</div>
            </div>
        </div>
    </div>

    <!-- Community Features -->
    <div class="row g-4">
        <div class="col-lg-4">
            <div class="card community-feature h-100">
                <div class="card-body text-center p-4">
                    <div class="feature-icon mb-3">
                        <i class="bi bi-chat-dots display-3 text-primary"></i>
                    </div>
                    <h5 class="card-title">Discussion Forums</h5>
                    <p class="card-text">
                        Join conversations about Python concepts, share your code, and get help from 
                        experienced developers and peers.
                    </p>
                    <a href="{% url 'forum:index' %}" class="btn btn-primary">Browse Discussions</a>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card community-feature h-100">
                <div class="card-body text-center p-4">
                    <div class="feature-icon mb-3">
                        <i class="bi bi-people display-3 text-success"></i>
                    </div>
                    <h5 class="card-title">Study Groups</h5>
                    <p class="card-text">
                        Form or join study groups to learn together, work on projects, and 
                        stay motivated on your Python journey.
                    </p>
                    <a href="{% url 'forum:index' %}" class="btn btn-success">Join Forum Discussions</a>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card community-feature h-100">
                <div class="card-body text-center p-4">
                    <div class="feature-icon mb-3">
                        <i class="bi bi-person-check display-3 text-info"></i>
                    </div>
                    <h5 class="card-title">Mentorship Program</h5>
                    <p class="card-text">
                        Connect with experienced Python developers who can guide you, 
                        review your code, and help accelerate your learning.
                    </p>
                    <a href="{% url 'forum:index' %}" class="btn btn-info">Connect with Experts</a>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card community-feature h-100">
                <div class="card-body text-center p-4">
                    <div class="feature-icon mb-3">
                        <i class="bi bi-code-slash display-3 text-warning"></i>
                    </div>
                    <h5 class="card-title">Code Reviews</h5>
                    <p class="card-text">
                        Submit your code for review by the community and learn best practices 
                        from constructive feedback.
                    </p>
                    <a href="{% url 'forum:index' %}" class="btn btn-warning">Get Code Review</a>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card community-feature h-100">
                <div class="card-body text-center p-4">
                    <div class="feature-icon mb-3">
                        <i class="bi bi-trophy display-3 text-danger"></i>
                    </div>
                    <h5 class="card-title">Coding Challenges</h5>
                    <p class="card-text">
                        Participate in weekly coding challenges, compete with peers, 
                        and showcase your programming skills.
                    </p>
                    <a href="{% url 'forum:index' %}" class="btn btn-danger">Join Discussions</a>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card community-feature h-100">
                <div class="card-body text-center p-4">
                    <div class="feature-icon mb-3">
                        <i class="bi bi-calendar-event display-3 text-purple"></i>
                    </div>
                    <h5 class="card-title">Events & Webinars</h5>
                    <p class="card-text">
                        Attend virtual events, workshops, and webinars hosted by Python 
                        experts and community leaders.
                    </p>
                    <a href="{% url 'forum:index' %}" class="btn btn-outline-primary">Forum Events</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Discussions -->
    <div class="row mt-5">
        <div class="col">
            <h3 class="mb-4">Recent Discussions</h3>
            <div class="card">
                <div class="card-body">
                    {% if recent_topics %}
                        {% for topic in recent_topics %}
                        <div class="discussion-item {% if not forloop.last %}border-bottom{% endif %} py-3">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6 class="mb-1">
                                        <a href="{% url 'forum_conversation:topic' topic.forum.slug topic.forum.pk topic.slug topic.pk %}" class="text-decoration-none">{{ topic.subject|truncatechars:80 }}</a>
                                    </h6>
                                    <p class="text-muted small mb-2">
                                        Posted in <strong>{{ topic.forum.name }}</strong>
                                    </p>
                                    <div class="discussion-meta small text-muted">
                                        <span>Started by <strong>{{ topic.poster.get_display_name|default:topic.poster.username }}</strong></span>
                                        <span class="mx-2">•</span>
                                        <span>{{ topic.created|timesince }} ago</span>
                                        <span class="mx-2">•</span>
                                        <span class="text-success">{{ topic.posts_count }} {% if topic.posts_count == 1 %}reply{% else %}replies{% endif %}</span>
                                    </div>
                                </div>
                                <div class="text-end">
                                    {% if topic.last_post %}
                                    <small class="text-muted">Latest reply<br>{{ topic.last_post_on|timesince }} ago</small>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-4">
                            <p class="text-muted">No discussions yet. Be the first to start a conversation!</p>
                            <a href="{% url 'forum:index' %}" class="btn btn-primary">Start a Discussion</a>
                        </div>
                    {% endif %}
                </div>
                <div class="card-footer text-center">
                    <a href="{% url 'forum:index' %}" class="btn btn-outline-primary">View All Discussions</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Call to Action -->
    <div class="row mt-5">
        <div class="col text-center">
            <div class="bg-primary text-white rounded p-5">
                <h3 class="mb-3">Ready to Join Our Community?</h3>
                <p class="lead mb-4">
                    Connect with thousands of Python learners and developers from around the world
                </p>
                {% if not user.is_authenticated %}
                    <a href="{% url 'account_signup' %}" class="btn btn-light btn-lg me-3">
                        <i class="bi bi-person-plus me-2"></i>Sign Up Free
                    </a>
                {% else %}
                    <a href="{% url 'forum:index' %}" class="btn btn-light btn-lg me-3">
                        <i class="bi bi-chat-dots me-2"></i>Start Discussing
                    </a>
                {% endif %}
                <a href="{% url 'forum:index' %}" class="btn btn-outline-light btn-lg">
                    <i class="bi bi-info-circle me-2"></i>Browse Forums
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.community-feature {
    transition: transform 0.2s ease-in-out;
    border: none;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.community-feature:hover {
    transform: translateY(-5px);
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
}

.feature-icon {
    height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.discussion-item:last-child {
    border-bottom: none !important;
}

.text-purple {
    color: #6f42c1 !important;
}

.btn-outline-primary:hover {
    transform: none;
}
</style>
{% endblock %}